<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bootstrap 5 Sidebar Navigation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
  <style>
    /* Custom CSS */
    .sidebar {
      overflow-y: auto;
    }
    #markdown-content {
      overflow-x: hidden; /* Prevent horizontal scrolling */
    }
    /* 去掉链接的下划线并添加间隔 */
    .nav-link {
      text-decoration: none; /* 去掉下划线 */
      padding: 8px 0; /* 添加垂直间隔 */
      display: block; /* 将链接元素转换为块级元素以充满父容器的宽度 */
    }
  </style>
</head>
<body>

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav id="sidebarMenu" class="col-md-2 col-lg-2 d-md-block bg-light sidebar navbar-text collapse">
      <div class="position-sticky top-0 pt-3">
        <!-- Sidebar content -->
        <form class="form-inline">
          <input class="form-control mb-2" type="text" placeholder="Search">
        </form>
        <hr class="my-3">
        <ul class="nav flex-column">
            <li class="nav-item">
              <div class="row text-center">
              <a class="nav-link active" aria-current="page" href="/index.html">
                <i class="bi bi-house-door-fill">首页</i>  <!-- 使用 Bootstrap Icons 的图标 -->
              </a>
              </div>
            </li>
          <hr class="my-3"> <!-- 添加一个水平分隔线 -->
          <div id="navigation"></div>
        </ul>
      </div>
    </nav>


    <div id="markdown-content" class="col-md-9 col-lg-10" style="padding-left: 10rem; padding-right: 20rem;">
      <!-- Markdown content will be loaded here -->
    </div>
  </div>
</div>

<script>
  let username = 'PeipengWang';
  let repo = 'StudyProcess';
  const param = getQueryParam('param');
  handleClick(param);
  function getQueryParam(param) {
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    return urlParams.get(param);
  }
  function loadMarkdown(url) {
    fetch(url).then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.text();
    }).then(markdown => {
      document.getElementById('markdown-content').innerHTML = marked.parse(markdown);
      let images = document.querySelectorAll('#markdown-content img');
      // Loop through each image and set CSS styles
      images.forEach(image => {
        image.style.maxWidth = '100%'; // Set maximum width to 100% of container
        image.style.height = 'auto'; // Maintain aspect ratio
      });
    }).catch(error => {
      console.error('There was a problem with your fetch operation:', error);
    });
  }


  function handleClick(framework) {
   let path = encodeURIComponent('网络编程/Netty 核心原理剖析与 RPC 实践_课件');
    if (framework === 'Netty') {
      path = encodeURIComponent('网络编程/Netty 核心原理剖析与 RPC 实践_课件');
    }
    if(framework === 'Spring'){
      path = encodeURIComponent('框架/Spring');
    }
    if(framework === 'Mybatis'){
      path = encodeURIComponent('框架/Mybatis');
    }
    if (framework === 'kafka') {
          path = encodeURIComponent('中间件/消息中间件/kafka');
    }
    // GitHub API URL
    let githubApiUrl = 'https://api.github.com/repos/' + username + '/' + repo + '/contents/' + path;
    // 获取 GitHub 仓库的目录结构
    fetch(githubApiUrl).then(response => {
      // 检查响应状态
      if (!response.ok) {
        throw new Error('Failed to fetch directory contents');
      }
      // 返回 JSON 格式的响应内容
      return response.json();
    }).then(contents => {
      // 创建导航栏
      var navigation = document.getElementById('navigation');
      var navList = document.createElement('ul');
      contents.forEach(item => {
        console.log(item);
        // 创建列表项并添加到导航栏中
        var listItem = document.createElement('li');
        var link = document.createElement('a');
        link.textContent = item.name;
        let rawUrl = "https://raw.githubusercontent.com/" + username + '/' + repo + "/main/" + encodeURIComponent(item.path);
        link.href = '#' + item.name;
        link.addEventListener('click', function() {
          if(rawUrl.endsWith(".md")){
            loadMarkdown(rawUrl);
          }
        });
        link.classList.add('nav-link');
        listItem.appendChild(link);
        navList.appendChild(listItem);
      });
      navigation.appendChild(navList);
    }).catch(error => {
      console.error('Error:', error);
    });
  }
</script>

</body>
</html>
